<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíò Valentine Game</title>

  <!-- Fonts: Intel One Mono + Ubuntu -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Intel+One+Mono:wght@300;400;600;700&family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#05050a;
      --bg1:#0b0a14;
      --ink:#0e0c12;

      /* SEGA-ish palette */
      --neon1:#00ffd5;
      --neon2:#ff2a6d;
      --neon3:#7d5cff;
      --neon4:#ffe66d;

      --ui:#141127;
      --ui2:#1b1635;

      --panel:#ffbfd6;   /* card interior */
      --panel2:#ff9fc6;

      --px: 4px;         /* pixel scale for borders */
      --radius: 18px;
      --shadow: 0 20px 70px rgba(0,0,0,.55);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1100px 700px at 15% 15%, rgba(0,255,213,.14), transparent 60%),
        radial-gradient(900px 650px at 85% 30%, rgba(255,42,109,.14), transparent 60%),
        radial-gradient(1000px 750px at 40% 90%, rgba(125,92,255,.14), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color: #fff;
      overflow:hidden;
      font-family: "Ubuntu", system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    /* ===== CRT overlay ===== */
    .crt{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:3;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(0,0,0,.18) 0px,
          rgba(0,0,0,.18) 1px,
          rgba(255,255,255,.02) 2px,
          rgba(255,255,255,.02) 4px
        );
      mix-blend-mode: overlay;
      opacity:.55;
    }
    .vignette{
      position:fixed; inset:-30%;
      pointer-events:none;
      z-index:2;
      background: radial-gradient(circle at 50% 50%, transparent 45%, rgba(0,0,0,.55) 75%);
      opacity:.7;
      filter: blur(18px);
    }

    /* ===== floating hearts layer ===== */
    .float-layer{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:4;
      overflow:hidden;
    }
    .float-heart{
      position:absolute;
      font-size: 18px;
      opacity:.9;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.35));
      animation: rise linear forwards;
      will-change: transform, opacity;
      user-select:none;
    }
    @keyframes rise{
      0%{ transform: translate3d(0, 40px, 0) scale(.9); opacity:0; }
      12%{ opacity:.95; }
      100%{ transform: translate3d(0, -120vh, 0) scale(1.25); opacity:0; }
    }

    /* ===== main layout ===== */
    .wrap{
      position:relative;
      height:100%;
      display:grid;
      place-items:center;
      padding:22px;
      z-index:5;
    }

    /* ===== pixel UI frame (SEGA vibe) ===== */
    .frame{
      width:min(980px, 96vw);
      min-height:min(560px, 80vh);
      background: linear-gradient(180deg, rgba(20,17,39,.92), rgba(13,11,26,.92));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;

      /* pixel border illusion */
      outline: calc(var(--px)*2) solid rgba(0,255,213,.22);
      outline-offset: -10px;
    }

    .frame::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 600px at 50% -20%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(90deg, rgba(0,255,213,.12), transparent 30%, rgba(255,42,109,.10) 70%, transparent);
      pointer-events:none;
      opacity:.9;
    }

    /* top HUD bar */
    .hud{
      position:relative;
      z-index:1;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:16px 18px 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .logo{
      display:flex;
      align-items:center;
      gap:12px;
      font-family: "Intel One Mono", ui-monospace, Menlo, Monaco, Consolas, monospace;
      font-weight: 800;
      letter-spacing: .6px;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 0 0 18px rgba(0,255,213,.25);
    }
    .logo .chip{
      width:14px; height:14px;
      background: var(--neon1);
      box-shadow: 0 0 0 6px rgba(0,255,213,.14), 0 0 28px rgba(0,255,213,.35);
    }
    .hud-right{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      font-family:"Intel One Mono", ui-monospace, monospace;
      font-weight:700;
      font-size:12px;
      letter-spacing:.35px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      padding:8px 10px;
      border-radius: 999px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .pill b{ color: var(--neon4); font-weight:800; }
    .pill .dot{
      width:8px; height:8px;
      border-radius:99px;
      background: var(--neon2);
      box-shadow: 0 0 18px rgba(255,42,109,.35);
    }

    /* ===== screen area ===== */
    .screen{
      position:relative;
      z-index:1;
      padding:18px;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
      height: calc(100% - 62px);
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,191,214,.95), rgba(255,159,198,.92));
      color: var(--ink);
      border-radius: 16px;
      box-shadow: 0 14px 40px rgba(0,0,0,.25);
      overflow:hidden;
      position:relative;
      border: 1px solid rgba(255,255,255,.35);
    }

    /* pixel corner accents */
    .panel::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(90deg, rgba(0,255,213,.14), transparent 30%, rgba(125,92,255,.12) 70%, transparent);
      opacity:.55;
      pointer-events:none;
    }

    .left{
      padding:22px 22px 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    h1{
      margin:0;
      font-family:"Intel One Mono", ui-monospace, monospace;
      font-weight: 900;
      font-size: clamp(26px, 3.2vw, 50px);
      line-height:1.05;
      letter-spacing:-.6px;
      text-transform: uppercase;
    }

    .sub{
      margin:0;
      font-size: clamp(14px, 1.55vw, 18px);
      line-height:1.55;
      opacity:.85;
      min-height: 3.6em;
    }

    .actions{
      margin-top:6px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:0;
      cursor:pointer;
      padding:12px 14px;
      border-radius: 12px;
      font-weight: 900;
      letter-spacing:.4px;
      font-family:"Intel One Mono", ui-monospace, monospace;
      text-transform: uppercase;
      transition: transform .08s ease, filter .2s ease, box-shadow .2s ease;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .btn-primary{
      color:white;
      background: linear-gradient(180deg, var(--neon2), #ff1f58);
      box-shadow: 0 16px 34px rgba(255,42,109,.32);
    }
    .btn-primary:hover{ filter: brightness(1.03); }

    .btn-ghost{
      background: rgba(255,255,255,.70);
      color: var(--ink);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 12px 26px rgba(0,0,0,.12);
    }

    .hint{
      margin-top:auto;
      padding-top:12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      font-size:12.5px;
      opacity:.7;
      font-family:"Intel One Mono", ui-monospace, monospace;
    }
    .kbd{
      padding:2px 8px;
      border-radius: 10px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(0,0,0,.10);
      font-weight:900;
    }

    /* ===== right side: Bubu & Dudu (NOT sega style) ===== */
    .right{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .charbox{
      display:grid;
      place-items:center;
      padding:12px;
    }
    .characters{
      width:100%;
      max-width: 360px;
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 14px 34px rgba(0,0,0,.14);
      position:relative;
      overflow:hidden;
    }
    .characters .bubble{
      position:absolute;
      left:12px; top:12px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(0,0,0,.08);
      padding:8px 10px;
      border-radius: 14px;
      font-family:"Ubuntu", system-ui;
      font-weight:700;
      color: var(--ink);
      font-size: 13px;
    }
    .characters .bubble b{
      font-family:"Intel One Mono", ui-monospace, monospace;
      text-transform: uppercase;
      letter-spacing:.3px;
    }

    /* little floating hearts above them */
    .top-hearts{
      position:absolute;
      left:50%;
      top:16px;
      transform: translateX(-50%);
      display:flex; gap:10px;
      pointer-events:none;
      opacity:.95;
    }
    .ph{
      width:14px; height:14px;
      transform: rotate(45deg);
      background: rgba(255,42,109,.85);
      border-radius: 3px;
      position:relative;
      animation: pop 1.6s ease-in-out infinite;
    }
    .ph::before,.ph::after{
      content:"";
      position:absolute;
      width:14px; height:14px;
      border-radius: 999px;
      background: inherit;
    }
    .ph::before{ left:-7px; top:0; }
    .ph::after{ left:0; top:-7px; }
    .ph:nth-child(2){ animation-delay:.25s; opacity:.75; transform: rotate(45deg) scale(.92); }
    .ph:nth-child(3){ animation-delay:.5s; opacity:.65; transform: rotate(45deg) scale(.85); }
    @keyframes pop{
      0%,100%{ transform: translateY(0) rotate(45deg) scale(1); }
      50%{ transform: translateY(-8px) rotate(45deg) scale(1.08); }
    }

    /* ===== mini game HUD ===== */
    .gamebar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      padding:12px 14px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 14px;
      box-shadow: 0 12px 26px rgba(0,0,0,.10);
      color: var(--ink);
      font-family:"Intel One Mono", ui-monospace, monospace;
      font-weight:900;
    }
    .gamebar .score{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .gamebar .score b{ color: var(--neon2); }

    /* catch heart button floats around */
    .catch{
      width: 62px;
      height: 62px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 14px 30px rgba(0,0,0,.14);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease;
    }
    .catch:active{ transform: scale(.98); }
    .catch span{ font-size: 26px; }

    /* ===== modal ===== */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding:20px;
    }
    .modal{
      width:min(760px, 96vw);
      background: linear-gradient(180deg, rgba(255,191,214,.98), rgba(255,159,198,.98));
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.45);
      box-shadow: 0 28px 90px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }
    .modal header{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(0,0,0,.10);
      font-family:"Intel One Mono", ui-monospace, monospace;
      text-transform: uppercase;
      letter-spacing:.4px;
      color: var(--ink);
      font-weight: 900;
    }
    .x{
      border:0;
      background: rgba(255,255,255,.70);
      border:1px solid rgba(0,0,0,.10);
      width:38px; height:38px;
      border-radius: 12px;
      cursor:pointer;
      font-size:18px;
      font-weight:900;
      color: var(--ink);
      display:grid;
      place-items:center;
    }
    .modal .content{
      padding:16px;
      color: var(--ink);
      line-height:1.55;
      font-family:"Ubuntu", system-ui;
    }
    .letter{
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 16px;
      padding:14px 14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
    }
    .letter p{ margin:0 0 10px; }
    .letter p:last-child{ margin-bottom:0; }

    .qa{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn-yes{
      background: linear-gradient(180deg, #19c37d, #11a86b);
      color:white;
      box-shadow: 0 18px 40px rgba(17,168,107,.25);
    }
    .btn-no{
      background: rgba(255,255,255,.70);
      color: var(--ink);
      border:1px solid rgba(0,0,0,.10);
      position:relative;
    }

    /* ===== toast ===== */
    .toast{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom:16px;
      padding:10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255,255,255,.85);
      color: var(--ink);
      font-family:"Intel One Mono", ui-monospace, monospace;
      font-weight:900;
      box-shadow: 0 18px 48px rgba(0,0,0,.35);
      z-index:60;
      display:none;
      gap:10px;
      align-items:center;
      text-transform: uppercase;
      letter-spacing:.35px;
    }

    /* responsive */
    @media (max-width: 860px){
      .screen{ grid-template-columns: 1fr; }
      .frame{ min-height: unset; }
      .characters{ max-width: 420px; }
    }
  </style>
</head>

<body>
  <div class="float-layer" id="floatLayer"></div>
  <div class="vignette"></div>
  <div class="crt"></div>

  <main class="wrap">
    <section class="frame" id="frame">

      <div class="hud">
        <div class="logo">
          <span class="chip"></span>
          <span>VALENTINE QUEST</span>
        </div>

        <div class="hud-right">
          <div class="pill"><span class="dot"></span> MODE: <b>LOVE</b></div>
          <div class="pill">PRESS <b>SPACE</b> = CONFETTI</div>
          <div class="pill">PRESS <b>H</b> = HEARTS</div>
        </div>
      </div>

      <div class="screen">
        <!-- LEFT: text + controls (SEGA UI style) -->
        <div class="panel left">
          <h1 id="headline">HAPPY VALENTINE DAY, MY MAN üíò</h1>
          <p class="sub" id="typed"></p>

          <div class="actions">
            <button class="btn btn-primary" id="openGifts">üéÅ OPEN GIFTS</button>
            <button class="btn btn-ghost" id="toggleHearts">üíñ HEARTS: NORMAL</button>
            <button class="btn btn-ghost" id="toggleSound" aria-pressed="false">üîà SOUND: OFF</button>
          </div>

          <div class="hint">
            <span class="kbd">SPACE</span> confetti
            <span class="kbd">H</span> hearts
            <span class="kbd">ESC</span> close
          </div>
        </div>

        <!-- RIGHT: Bubu & Dudu (drawn) + mini game -->
        <div class="right">
          <div class="panel charbox">
            <div class="characters">
              <div class="bubble"><b>BUBU</b> + <b>DUDU</b> = ‚ù§Ô∏è</div>

              <div class="top-hearts">
                <i class="ph"></i><i class="ph"></i><i class="ph"></i>
              </div>

              <!-- BUBU & DUDU SVG (cute, not SEGA) -->
              <svg viewBox="0 0 400 400" width="100%" height="100%" aria-label="Bubu and Dudu">
                <!-- background blush -->
                <defs>
                  <radialGradient id="bg" cx="50%" cy="40%" r="70%">
                    <stop offset="0%" stop-color="#ffffff" stop-opacity=".75"/>
                    <stop offset="100%" stop-color="#ffd6e6" stop-opacity=".35"/>
                  </radialGradient>
                  <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="#000" flood-opacity=".18"/>
                  </filter>
                </defs>
                <rect x="0" y="0" width="400" height="400" rx="24" fill="url(#bg)"/>

                <!-- little hearts -->
                <g opacity=".9">
                  <text x="230" y="90" font-size="22">üíó</text>
                  <text x="260" y="70" font-size="18">üíñ</text>
                  <text x="205" y="65" font-size="16">üíò</text>
                </g>

                <!-- Dudu (white) -->
                <g filter="url(#softShadow)">
                  <!-- head -->
                  <circle cx="250" cy="180" r="78" fill="#ffffff" stroke="#2c2032" stroke-opacity=".08" stroke-width="3"/>
                  <!-- ears -->
                  <circle cx="200" cy="120" r="22" fill="#ffffff" stroke="#2c2032" stroke-opacity=".08" stroke-width="3"/>
                  <circle cx="300" cy="120" r="22" fill="#ffffff" stroke="#2c2032" stroke-opacity=".08" stroke-width="3"/>
                  <circle cx="200" cy="120" r="11" fill="#2c2032" opacity=".10"/>
                  <circle cx="300" cy="120" r="11" fill="#2c2032" opacity=".10"/>
                  <!-- face -->
                  <circle cx="230" cy="175" r="6" fill="#1a1020"/>
                  <circle cx="270" cy="175" r="6" fill="#1a1020"/>
                  <path d="M245 190 q5 8 10 0" stroke="#1a1020" stroke-width="4" fill="none" stroke-linecap="round"/>
                  <!-- blush -->
                  <ellipse cx="215" cy="200" rx="18" ry="10" fill="#ff2a6d" opacity=".18"/>
                  <ellipse cx="285" cy="200" rx="18" ry="10" fill="#ff2a6d" opacity=".18"/>
                  <!-- body -->
                  <path d="M205 245
                           q45 -20 90 0
                           q25 55 -10 100
                           q-35 30 -70 0
                           q-35 -45 -10 -100 z"
                        fill="#ffffff" stroke="#2c2032" stroke-opacity=".06" stroke-width="3"/>
                </g>

                <!-- Bubu (brown) hugging -->
                <g filter="url(#softShadow)">
                  <!-- head -->
                  <circle cx="160" cy="205" r="74" fill="#c28a6f" stroke="#1a1020" stroke-opacity=".10" stroke-width="3"/>
                  <!-- ears -->
                  <circle cx="115" cy="150" r="22" fill="#c28a6f" stroke="#1a1020" stroke-opacity=".10" stroke-width="3"/>
                  <circle cx="205" cy="150" r="22" fill="#c28a6f" stroke="#1a1020" stroke-opacity=".10" stroke-width="3"/>
                  <circle cx="115" cy="150" r="11" fill="#1a1020" opacity=".10"/>
                  <circle cx="205" cy="150" r="11" fill="#1a1020" opacity=".10"/>
                  <!-- face -->
                  <circle cx="140" cy="205" r="6" fill="#1a1020"/>
                  <circle cx="180" cy="205" r="6" fill="#1a1020"/>
                  <path d="M155 220 q5 8 10 0" stroke="#1a1020" stroke-width="4" fill="none" stroke-linecap="round"/>
                  <!-- blush -->
                  <ellipse cx="125" cy="235" rx="18" ry="10" fill="#ff2a6d" opacity=".16"/>
                  <ellipse cx="195" cy="235" rx="18" ry="10" fill="#ff2a6d" opacity=".16"/>
                  <!-- body -->
                  <path d="M115 270
                           q45 -25 90 0
                           q30 55 -5 95
                           q-35 32 -75 0
                           q-35 -45 -10 -95 z"
                        fill="#c28a6f" stroke="#1a1020" stroke-opacity=".06" stroke-width="3"/>
                  <!-- arms hug -->
                  <path d="M185 288
                           q55 10 70 50
                           q-12 12 -28 8
                           q-18 -26 -55 -30 z"
                        fill="#c28a6f" opacity=".98"/>
                  <path d="M210 295
                           q35 12 45 35
                           q-10 10 -22 6
                           q-12 -18 -33 -22 z"
                        fill="#c28a6f" opacity=".98"/>
                </g>

                <!-- ground -->
                <ellipse cx="205" cy="370" rx="150" ry="20" fill="#1a1020" opacity=".08"/>
              </svg>
            </div>
          </div>

          <div class="gamebar">
            <div class="score">üß° SCORE: <b id="score">0</b></div>
            <div>CLICK üíò TO CATCH</div>
          </div>

          <button class="catch" id="catchBtn" title="–ü–æ–π–º–∞–π —Å–µ—Ä–¥–µ—á–∫–æ!">
            <span>üíò</span>
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL -->
  <div class="modal-backdrop" id="backdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <header>
        <span id="modalTitle">LOVE LETTER</span>
        <button class="x" id="closeModal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>

      <div class="content">
        <div class="letter" id="letter">
          <p><b>–õ—é–±–∏–º—ã–π,</b></p>
          <p>
            –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –≤ —Ç–µ–±–µ —Ç–æ, —á—Ç–æ —Ä–µ–¥–∫–æ –±—ã–≤–∞–µ—Ç –≤ –ª—é–¥—è—Ö: —Å–ø–æ–∫–æ–π–Ω–∞—è —Å–∏–ª–∞, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–æ,
            —á—Ç–æ —Ä—è–¥–æ–º ‚Äî –º–æ–π —á–µ–ª–æ–≤–µ–∫.
          </p>
          <p>
            –Ø –Ω–µ —Ö–æ—á—É ‚Äú–∫—Ä–∞—Å–∏–≤—ã—Ö —Å–ª–æ–≤ —Ä–∞–¥–∏ —Å–ª–æ–≤‚Äù. –Ø —Ö–æ—á—É —Ç–µ–±—è ‚Äî —Ä—è–¥–æ–º, –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É, –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.
            –ò –¥–∞, —è –≤—ã–±–∏—Ä–∞—é —Ç–µ–±—è. ‚ù§Ô∏è
          </p>
          <p style="opacity:.75;margin-top:10px">
            P.S. –ü–æ–π–º–∞–π –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–¥–µ—Ü ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—é—Ä–ø—Ä–∏–∑.
          </p>
        </div>

        <div class="qa">
          <button class="btn btn-primary btn-yes" id="yesBtn">–î–ê, –Ø –¢–í–û–Ø üíö</button>
          <button class="btn btn-no" id="noBtn">–ù–ï–¢ üôÉ</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">‚ú®</div>

  <script>
    // =======================
    //   TEXT (female -> boyfriend)
    // =======================
    const CONFIG = {
      headline: "HAPPY VALENTINE DAY, MY MAN üíò",
      typedText:
        "–° —Ç–æ–±–æ–π —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Å–ø–æ–∫–æ–π–Ω–æ –∏ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –ª—é–±–∏–º–æ–π. " +
        "–¢—ã ‚Äî –º–æ—è –æ–ø–æ—Ä–∞, –º–æ–π –º—É–∂—á–∏–Ω–∞ –∏ –º–æ–π —Å–∞–º—ã–π —Ç—ë–ø–ª—ã–π –≤—ã–±–æ—Ä. " +
        "–ù–∞–∂–º–∏ ¬´OPEN GIFTS¬ª ‚Äî –∏ –Ω–µ –¥–µ–ª–∞–π –≤–∏–¥, —á—Ç–æ —Ç—ã –Ω–µ —É–ª—ã–±–∞–µ—à—å—Å—è üòå",
      unlockScore: 7, // hearts to unlock surprise
    };

    // ====== Helpers ======
    const $ = (sel, el=document) => el.querySelector(sel);
    const rand = (a,b)=>Math.random()*(b-a)+a;

    // ====== Apply headline + typing effect ======
    const headlineEl = $("#headline");
    const typedEl = $("#typed");
    headlineEl.textContent = CONFIG.headline;

    let ti = 0;
    function typeTick(){
      const s = CONFIG.typedText;
      typedEl.textContent = s.slice(0, ti);
      ti = Math.min(s.length, ti + 2);
      if(ti < s.length) requestAnimationFrame(typeTick);
    }
    typeTick();

    // ====== Floating hearts ======
    const layer = $("#floatLayer");
    let heartsInterval = null;
    let heartsBoost = false;

    function spawnHeart(){
      const el = document.createElement("div");
      el.className = "float-heart";
      const hearts = ["üíó","üíñ","üíò","üíù","üíû","üíì","üíü"];
      el.textContent = hearts[(Math.random()*hearts.length)|0];

      const left = rand(2, 98);
      const dur = rand(4.5, 9.5) * (heartsBoost ? 0.7 : 1);
      const size = rand(14, 28) * (heartsBoost ? 1.08 : 1);

      el.style.left = left + "vw";
      el.style.bottom = "-40px";
      el.style.fontSize = size + "px";
      el.style.animationDuration = dur + "s";
      el.style.transform = `translate3d(${rand(-12,12)}px, 0, 0)`;

      layer.appendChild(el);
      setTimeout(()=> el.remove(), dur*1000 + 200);
    }

    function startHearts(){
      if(heartsInterval) return;
      heartsInterval = setInterval(()=>{
        spawnHeart();
        if(heartsBoost) spawnHeart();
      }, heartsBoost ? 220 : 420);
    }
    function stopHearts(){
      clearInterval(heartsInterval);
      heartsInterval = null;
    }
    startHearts();

    const toggleHeartsBtn = $("#toggleHearts");
    toggleHeartsBtn.addEventListener("click", ()=>{
      heartsBoost = !heartsBoost;
      toggleHeartsBtn.textContent = heartsBoost ? "üíñ HEARTS: MAX" : "üíñ HEARTS: NORMAL";
      toast(heartsBoost ? "HEARTS MAX" : "HEARTS NORMAL");
      stopHearts(); startHearts();
    });

    // ====== Confetti (pure JS canvas) ======
    function confettiBurst(count=140){
      const c = document.createElement("canvas");
      c.width = innerWidth;
      c.height = innerHeight;
      c.style.position = "fixed";
      c.style.inset = "0";
      c.style.zIndex = "45";
      c.style.pointerEvents = "none";
      document.body.appendChild(c);

      const ctx = c.getContext("2d");
      const pieces = Array.from({length:count}, () => ({
        x: innerWidth/2 + rand(-40, 40),
        y: innerHeight/2 + rand(-30, 30),
        vx: rand(-6, 6),
        vy: rand(-10, -2),
        g: rand(0.18, 0.32),
        s: rand(4, 9),
        r: rand(0, Math.PI*2),
        vr: rand(-0.25, 0.25),
        a: 1,
      }));

      let t = 0;
      const maxT = 210;

      function frame(){
        t++;
        ctx.clearRect(0,0,c.width,c.height);
        pieces.forEach(p=>{
          p.vy += p.g;
          p.x += p.vx;
          p.y += p.vy;
          p.r += p.vr;
          p.a *= 0.992;

          ctx.save();
          ctx.globalAlpha = Math.max(0, p.a);
          ctx.translate(p.x, p.y);
          ctx.rotate(p.r);
          ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s*0.7);
          ctx.restore();
        });

        if(t < maxT){
          requestAnimationFrame(frame);
        } else {
          c.remove();
        }
      }
      frame();
    }

    // ====== Modal ======
    const backdrop = $("#backdrop");
    function openModal(){
      backdrop.style.display = "flex";
      confettiBurst(180);
      toast("OPENED");
      playWin();
    }
    function closeModal(){
      backdrop.style.display = "none";
    }

    $("#openGifts").addEventListener("click", openModal);
    $("#closeModal").addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e)=>{
      if(e.target === backdrop) closeModal();
    });

    // ====== Mini game: catch heart ======
    let score = 0;
    const scoreEl = $("#score");
    const catchBtn = $("#catchBtn");

    function moveCatch(){
      const frame = $("#frame");
      const rect = frame.getBoundingClientRect();
      const x = rand(rect.left + rect.width*0.62, rect.right - 90);
      const y = rand(rect.top + 120, rect.bottom - 90);

      catchBtn.style.position = "fixed";
      catchBtn.style.left = Math.min(innerWidth - 90, Math.max(10, x)) + "px";
      catchBtn.style.top  = Math.min(innerHeight - 90, Math.max(10, y)) + "px";
    }
    setTimeout(()=> moveCatch(), 450);

    catchBtn.addEventListener("click", ()=>{
      score++;
      scoreEl.textContent = score;
      spawnHeart();
      confettiBurst(55);
      playPop();
      moveCatch();

      if(score === CONFIG.unlockScore){
        $("#letter").innerHTML = `
          <p><b>–°–Æ–†–ü–†–ò–ó –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù ‚úÖ</b></p>
          <p>–¢—ã –ø–æ–π–º–∞–ª <b>${CONFIG.unlockScore}</b> —Å–µ—Ä–¥–µ—Ü. –ó–Ω–∞—á–∏—Ç –≤—Å—ë —á–µ—Å—Ç–Ω–æ: —Å–µ–≥–æ–¥–Ω—è –º–æ–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫ ‚Äî <b>–¥–µ–Ω—å ‚Äú–º–æ–π –º—É–∂—á–∏–Ω–∞‚Äù</b>.</p>
          <p>–Ø –ª—é–±–ª—é —Ç–µ–±—è. –ù–µ ‚Äú–∫–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ‚Äù, –∞ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É. ‚ù§Ô∏è</p>
        `;
        openModal();
        toast("UNLOCKED");
      }
    });

    // ====== Yes / No buttons ======
    $("#yesBtn").addEventListener("click", ()=>{
      confettiBurst(240);
      toast("YES üíö");
      playWin();
    });

    const noBtn = $("#noBtn");
    noBtn.addEventListener("mouseenter", dodgeNo);
    noBtn.addEventListener("click", dodgeNo);

    function dodgeNo(){
      const modal = $(".modal");
      const r = modal.getBoundingClientRect();
      const x = rand(r.left + 14, r.right - 130);
      const y = rand(r.top + 70, r.bottom - 70);
      noBtn.style.position = "fixed";
      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
      toast("NOPE üôÉ");
      playPop();
    }

    // ====== Toast ======
    const toastEl = $("#toast");
    let toastTimer = null;
    function toast(text){
      toastEl.textContent = text;
      toastEl.style.display = "flex";
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toastEl.style.display="none", 1600);
    }

    // ====== Keyboard shortcuts ======
    window.addEventListener("keydown", (e)=>{
      if(e.key === "Escape") closeModal();
      if(e.key === " "){
        e.preventDefault();
        confettiBurst(160);
        toast("BOOM ‚ú®");
        playWin();
      }
      if(e.key.toLowerCase() === "h"){
        heartsBoost = !heartsBoost;
        toggleHeartsBtn.textContent = heartsBoost ? "üíñ HEARTS: MAX" : "üíñ HEARTS: NORMAL";
        stopHearts(); startHearts();
        toast(heartsBoost ? "HEARTS MAX" : "HEARTS NORMAL");
      }
    });

    // ====== Optional sound (WebAudio, no files) ======
    let soundOn = false;
    let audioCtx = null;

    $("#toggleSound").addEventListener("click", ()=>{
      soundOn = !soundOn;
      $("#toggleSound").setAttribute("aria-pressed", String(soundOn));
      $("#toggleSound").textContent = soundOn ? "üîä SOUND: ON" : "üîà SOUND: OFF";
      toast(soundOn ? "SOUND ON" : "SOUND OFF");
      if(soundOn) ensureAudio();
    });

    function ensureAudio(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if(audioCtx.state === "suspended") audioCtx.resume();
    }

    function beep(freq=440, dur=0.08, type="square", gain=0.03){
      if(!soundOn) return;
      ensureAudio();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      o.stop(audioCtx.currentTime + dur);
    }
    function playPop(){
      beep(784, 0.055, "square", 0.03);
      beep(988, 0.05, "square", 0.02);
    }
    function playWin(){
      beep(523.25, 0.07, "square", 0.03);
      beep(659.25, 0.07, "square", 0.03);
      beep(783.99, 0.10, "square", 0.03);
    }

    window.addEventListener("resize", ()=> moveCatch());
  </script>
</body>
</html>
